#include "PrecompiledHeader.h"
#include "GameWorld.h"

void GameWorld::Initialize()
{
	World::Initialize();


	{
		auto camera = CreateEntity();
		auto transform = AddComponent<Components::Transform>(camera, "Transform");
		transform->Position.z = 20.f;
		transform->Position.y = 20.f;
		transform->Orientation = glm::quat(glm::vec3(glm::pi<float>() / 8.f, 0.f, 0.f));
		auto cameraComp = AddComponent<Components::Camera>(camera, "Camera");
		cameraComp->FarClip = 2000.f;
		AddComponent(camera, "Input");
		auto freeSteering = AddComponent<Components::FreeSteering>(camera, "FreeSteering");
		CommitEntity(camera);
	}


	{
		auto ground = CreateEntity();
		auto transform = AddComponent<Components::Transform>(ground, "Transform");
		transform->Position = glm::vec3(0, -5, 0);
		transform->Scale = glm::vec3(1000.0f, 10.0f, 1000.0f);
		transform->Orientation = glm::quat(glm::vec3(0.0f, 0.0f, 0.0f));
		auto model = AddComponent<Components::Model>(ground, "Model");
		model->ModelFile = "Models/Placeholders/PhysicsTest/Cube.obj";
		auto box = AddComponent<Components::Box>(ground, "Box");
		box->Width = 500;
		box->Height = 5;
		box->Depth = 500;

		auto physics = AddComponent<Components::Physics>(ground, "Physics");
		physics->Mass = 10;
<<<<<<< HEAD
		physics->Static = true;
=======
		CommitEntity(ground);
>>>>>>> 84d6911... Barebones entity component commit events
	}


	{
		auto car = CreateEntity();
		auto transform = AddComponent<Components::Transform>(car, "Transform");
		transform->Position = glm::vec3(0, 5, 0);
		transform->Scale = glm::vec3(3, 1, 5);
		transform->Orientation = glm::quat(glm::vec3(0.0f, 0.0f, 0.0f));
		auto model = AddComponent<Components::Model>(car, "Model");
		model->ModelFile = "Models/Placeholders/PhysicsTest/Cube2.obj";
		auto physics = AddComponent<Components::Physics>(car, "Physics");
		physics->Mass = 1200;
		auto box = AddComponent<Components::Box>(car, "Box");
		box->Width = 1.5f;
		box->Height = 0.5f;
		box->Depth = 2.5f;
		auto vehicle = AddComponent<Components::Vehicle>(car, "Vehicle");
		AddComponent<Components::Input>(car, "Input");
	
		{
			// Front Right Wheel
			auto ent = CreateEntity(car);
			auto transform = AddComponent<Components::Transform>(ent, "Transform");
			transform->Position = glm::vec3(1.1f, -0.5f, -1.3f);
			auto Wheel = AddComponent<Components::Wheel>(ent, "Wheel");
			Wheel->Hardpoint = glm::vec3(1.1f, 0.f, -1.3f);// HACK: make into component
			Wheel->AxleID = 0;
			Wheel->Mass = 10;
			Wheel->Radius = 0.6f;
			Wheel->Steering = true;
		}
		{
			// Front Left Wheel
			auto ent = CreateEntity(car);
			auto transform = AddComponent<Components::Transform>(ent, "Transform");
			transform->Position = glm::vec3(-1.1f, -0.5f, -1.3f);
			auto Wheel = AddComponent<Components::Wheel>(ent, "Wheel");
			Wheel->Hardpoint = glm::vec3(-1.1f, 0.f, -1.3f);
			Wheel->AxleID = 0;
			Wheel->Mass = 10;
			Wheel->Radius = 0.6f;
			Wheel->Steering = true;
		}
		{
			// Back Right Wheel
			auto ent = CreateEntity(car);
			auto transform = AddComponent<Components::Transform>(ent, "Transform");
			transform->Position = glm::vec3(1.1f, -0.5f, 1.3f);
			auto Wheel = AddComponent<Components::Wheel>(ent, "Wheel");
			Wheel->Hardpoint = glm::vec3(1.1f, 0.f, 1.3f);
			Wheel->AxleID = 1;
			Wheel->Mass = 10;
			Wheel->Radius = 0.6f;
			Wheel->Steering = false;
		}
		{
			// Back Left Wheel
			auto ent = CreateEntity(car);
			auto transform = AddComponent<Components::Transform>(ent, "Transform");
			transform->Position = glm::vec3(-1.1f, -0.5f, 1.3f);
			auto Wheel = AddComponent<Components::Wheel>(ent, "Wheel");
			Wheel->Hardpoint = glm::vec3(-1.1f, 0.f, 1.3f);
			Wheel->AxleID = 1;
			Wheel->Mass = 10;
			Wheel->Radius = 0.6f;
			Wheel->Steering = false;
		}

<<<<<<< HEAD
	}

=======
		auto model = AddComponent<Components::Model>(TankTest, "Model");
		model->ModelFile = "Models/Placeholders/tank/Chassi.obj";
		CommitEntity(TankTest);
	}

	for(int i = 0; i < 83; i++)
	{
		auto light = CreateEntity();
		auto transform = AddComponent<Components::Transform>(light, "Transform");
		transform->Position = glm::vec3((float)(2*i)*glm::sin((float)i), 3, (float)(2*i)*glm::cos((float)i));

		auto pointLight = AddComponent<Components::PointLight>(light, "PointLight");
		pointLight->Specular = glm::vec3(0.1f, 0.1f, 0.1f);
		pointLight->Diffuse = glm::vec3(0.05f, 0.36f, 1.f);
		pointLight->constantAttenuation = 0.03f;
		pointLight->linearAttenuation = 0.009f;
		pointLight->quadraticAttenuation = 0.07f;
		pointLight->spotExponent = 0.0f;

		auto model = AddComponent<Components::Model>(light, "Model");
		model->ModelFile = "Models/Placeholders/PhysicsTest/PointLight.obj";
		CommitEntity(light);
	}
>>>>>>> 84d6911... Barebones entity component commit events


	for(int i = 0; i < 50; i++)
	{
		auto ball = CreateEntity();
		auto transform = AddComponent<Components::Transform>(ball, "Transform");
		transform->Position = glm::vec3(243, 10 + i*10, 0);
		transform->Scale = glm::vec3(10);
		transform->Orientation = glm::quat(glm::vec3(0.0f, 0.0f, 0.0f));
		auto model = AddComponent<Components::Model>(ball, "Model");
		model->ModelFile = "Models/Placeholders/PhysicsTest/Cube2.obj";
		auto physics = AddComponent<Components::Physics>(ball, "Physics");
<<<<<<< HEAD
		physics->Mass = 100;
		auto box = AddComponent<Components::Box>(ball, "Box");
		box->Width = 5.f;
		box->Height = 5.f;
		box->Depth = 5.f;
=======
		physics->Mass = 1;
		CommitEntity(ball);
>>>>>>> 84d6911... Barebones entity component commit events
	}

	{
		auto entity = CreateEntity();
		AddComponent(entity, "Transform");
		auto emitter = AddComponent<Components::SoundEmitter>(entity, "SoundEmitter");
		emitter->Path = "Sounds/korvring.wav";
		emitter->Loop = true;
		GetSystem<Systems::SoundSystem>("SoundSystem")->PlaySound(emitter);
	}
}

void GameWorld::Update(double dt)
{
	World::Update(dt);
}

void GameWorld::RegisterComponents()
{
	m_ComponentFactory.Register("Camera", []() { return new Components::Camera(); });
	m_ComponentFactory.Register("DirectionalLight", []() { return new Components::DirectionalLight(); });
	m_ComponentFactory.Register("Input", []() { return new Components::Input(); });
	m_ComponentFactory.Register("Model", []() { return new Components::Model(); });
	m_ComponentFactory.Register("ParticleEmitter", []() { return new Components::ParticleEmitter(); });
	m_ComponentFactory.Register("PointLight", []() { return new Components::PointLight(); });
	m_ComponentFactory.Register("SoundEmitter", []() { return new Components::SoundEmitter(); });
	m_ComponentFactory.Register("Sprite", []() { return new Components::Sprite(); });
	m_ComponentFactory.Register("Template", []() { return new Components::Template(); });
	m_ComponentFactory.Register("Transform", []() { return new Components::Transform(); });
	m_ComponentFactory.Register("FreeSteering", []() { return new Components::FreeSteering(); });
	m_ComponentFactory.Register("Physics", []() { return new Components::Physics(); });
	m_ComponentFactory.Register("Sphere", []() { return new Components::Sphere(); });
	m_ComponentFactory.Register("Box", []() { return new Components::Box (); });
	m_ComponentFactory.Register("Vehicle", []() { return new Components::Vehicle(); });
	m_ComponentFactory.Register("Wheel", []() { return new Components::Wheel(); });
}

void GameWorld::RegisterSystems()
{
	m_SystemFactory.Register("TransformSystem", [this]() { return new Systems::TransformSystem(this); });
	//m_SystemFactory.Register("LevelGenerationSystem", [this]() { return new Systems::LevelGenerationSystem(this); });
	m_SystemFactory.Register("InputSystem", [this]() { return new Systems::InputSystem(this, m_Renderer); });
	//m_SystemFactory.Register("CollisionSystem", [this]() { return new Systems::CollisionSystem(this); });
	////m_SystemFactory.Register("ParticleSystem", [this]() { return new Systems::ParticleSystem(this); });
	//m_SystemFactory.Register("PlayerSystem", [this]() { return new Systems::PlayerSystem(this); });
	m_SystemFactory.Register("FreeSteeringSystem", [this]() { return new Systems::FreeSteeringSystem(this); });
	m_SystemFactory.Register("SoundSystem", [this]() { return new Systems::SoundSystem(this); });

	m_SystemFactory.Register("PhysicsSystem", [this]() { return new Systems::PhysicsSystem(this); });

	m_SystemFactory.Register("RenderSystem", [this]() { return new Systems::RenderSystem(this, m_Renderer); });


}

void GameWorld::AddSystems()
{
	AddSystem("TransformSystem");
	//AddSystem("LevelGenerationSystem");
	AddSystem("InputSystem");
	//AddSystem("CollisionSystem");
	////AddSystem("ParticleSystem");
	//AddSystem("PlayerSystem");
	AddSystem("FreeSteeringSystem");
	AddSystem("SoundSystem");

	AddSystem("PhysicsSystem");

	AddSystem("RenderSystem");


}